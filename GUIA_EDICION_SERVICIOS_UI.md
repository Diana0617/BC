# ğŸ¨ GuÃ­a de EdiciÃ³n de Servicios en el Modal de Turnos

## ğŸ“± Vista del Modal - Estado Normal

Cuando abres un turno en estado `IN_PROGRESS`, `CONFIRMED` o `PENDING`, verÃ¡s la secciÃ³n de servicios con un botÃ³n **"Editar"**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Servicios                    [âœï¸ Editar]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚   â”œâ”€ Corte de Cabello                          â”‚
â”‚   â”‚  DuraciÃ³n: 30 min                 $40,000  â”‚
â”‚                                                 â”‚
â”‚   â”œâ”€ Arreglo de Barba                          â”‚
â”‚   â”‚  DuraciÃ³n: 30 min                 $35,000  â”‚
â”‚                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   DuraciÃ³n total: 60 min                        â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœï¸ Modo de EdiciÃ³n - Agregar/Quitar Servicios

Al hacer clic en **"Editar"**, el modal cambia a modo de ediciÃ³n:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Servicios                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ Servicios seleccionados:                        â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Corte de Cabello              [â–]      â”‚    â”‚
â”‚ â”‚ 30 min â€¢ $40,000                        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Arreglo de Barba              [â–]      â”‚    â”‚
â”‚ â”‚ 30 min â€¢ $35,000                        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                 â”‚
â”‚ Agregar servicios:                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ ğŸ“¦ ColoraciÃ³n              [â•]       â”‚      â”‚
â”‚ â”‚    45 min â€¢ $75,000                   â”‚      â”‚
â”‚ â”‚                                        â”‚      â”‚
â”‚ â”‚ ğŸ“¦ Tratamiento Capilar     [â•]       â”‚      â”‚
â”‚ â”‚    60 min â€¢ $90,000                   â”‚      â”‚
â”‚ â”‚                                        â”‚      â”‚
â”‚ â”‚ ğŸ“¦ Lavado Premium          [â•]       â”‚      â”‚
â”‚ â”‚    15 min â€¢ $15,000                   â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Resumen:                                â”‚    â”‚
â”‚ â”‚ Total servicios: 2                       â”‚    â”‚
â”‚ â”‚ DuraciÃ³n: 60 min  â€¢  $75,000            â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚
â”‚ [  Cancelar  ]  [ âœ“ Guardar Cambios ]          â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ Flujo de Uso - Caso Real

### **Escenario: Juan PÃ©rez decide agregar ColoraciÃ³n**

**1. Estado inicial del turno:**
- âœ… Corte de Cabello (30 min - $40,000)
- âœ… Arreglo de Barba (30 min - $35,000)
- **Total:** 60 min - $75,000

**2. Durante el turno, Juan dice:**
> "Me gustarÃ­a agregarme coloraciÃ³n"

**3. El especialista hace clic en** `[âœï¸ Editar]`

**4. Se muestra el modo de ediciÃ³n con:**
- Lista de servicios actuales (con botÃ³n â– para quitar)
- Lista de servicios disponibles (con botÃ³n â• para agregar)

**5. El especialista hace clic en** `[â•]` **junto a "ColoraciÃ³n"**

**6. El resumen se actualiza en tiempo real:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resumen:                            â”‚
â”‚ Total servicios: 3                  â”‚
â”‚ DuraciÃ³n: 105 min  â€¢  $150,000     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**7. El especialista hace clic en** `[âœ“ Guardar Cambios]`

**8. El sistema:**
- âœ… Valida que no hay conflictos con la siguiente cita
- âœ… Actualiza la duraciÃ³n (60 min â†’ 105 min)
- âœ… Actualiza el monto ($75,000 â†’ $150,000)
- âœ… Recalcula `endTime` automÃ¡ticamente
- âœ… Muestra notificaciÃ³n de Ã©xito
- âœ… Vuelve a la vista normal con los 3 servicios

---

## âš ï¸ Validaciones AutomÃ¡ticas

### **Conflicto de Horario Detectado**

Si agregar servicios causa conflicto con la siguiente cita:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Error                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ No se pueden agregar estos servicios.           â”‚
â”‚                                                 â”‚
â”‚ El nuevo horario (hasta 11:45) entra en         â”‚
â”‚ conflicto con otra cita a las 11:30             â”‚
â”‚                                                 â”‚
â”‚ Sugerencia: Reagendar la siguiente cita o       â”‚
â”‚ seleccionar menos servicios.                     â”‚
â”‚                                                 â”‚
â”‚              [   Entendido   ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Sin Servicios Seleccionados**

Si intentas guardar sin servicios:

```
ğŸ”´ Debes tener al menos un servicio
```

### **Estado de Cita Bloqueado**

En citas `COMPLETED` o `CANCELED`, el botÃ³n **"Editar"** NO aparece.

---

## ğŸ¨ Elementos Visuales

### **Iconos utilizados:**
- âœï¸ `PencilSquareIcon` - BotÃ³n de editar
- â• `PlusCircleIcon` - Agregar servicio
- â– `MinusCircleIcon` - Quitar servicio
- âœ… `CheckCircleIcon` - Guardar cambios
- ğŸ“‹ `TagIcon` - SecciÃ³n de servicios

### **Colores por estado:**
- ğŸ”µ Azul - Modo ediciÃ³n activo
- ğŸŸ¢ Verde - AcciÃ³n exitosa
- ğŸ”´ Rojo - Quitar servicio / Error
- âšª Gris - Servicios disponibles

---

## ğŸ“Š InformaciÃ³n en Tiempo Real

El **Resumen** se actualiza automÃ¡ticamente mientras agregas/quitas servicios:

| Campo | CÃ¡lculo |
|-------|---------|
| **Total servicios** | Cantidad de servicios seleccionados |
| **DuraciÃ³n** | Suma de duraciones de todos los servicios |
| **Precio Total** | Suma de precios de todos los servicios |

---

## ğŸ”„ SincronizaciÃ³n con Backend

Cuando haces clic en **"Guardar Cambios"**, se ejecuta:

```javascript
PUT /api/appointments/:id?businessId={bizId}
{
  "serviceIds": ["uuid1", "uuid2", "uuid3"]
}
```

**El backend:**
1. âœ… Valida servicios activos
2. âœ… Recalcula duraciÃ³n total
3. âœ… Recalcula precio total
4. âœ… Verifica conflictos de horario
5. âœ… Actualiza tabla `appointment_services`
6. âœ… Recalcula `endTime`
7. âœ… Retorna cita actualizada

**El frontend:**
1. âœ… Muestra loading indicator
2. âœ… Recibe respuesta exitosa
3. âœ… Recarga detalles de la cita
4. âœ… Cierra modo de ediciÃ³n
5. âœ… Muestra toast de Ã©xito
6. âœ… Actualiza lista de turnos

---

## ğŸ’¡ Casos de Uso Adicionales

### **Quitar un servicio que el cliente no quiere:**

1. Click en `[âœï¸ Editar]`
2. Click en `[â–]` junto al servicio a quitar
3. Revisar resumen actualizado
4. Click en `[âœ“ Guardar Cambios]`

### **Reemplazar todos los servicios:**

1. Click en `[âœï¸ Editar]`
2. Quitar todos los servicios actuales con `[â–]`
3. Agregar nuevos servicios con `[â•]`
4. Click en `[âœ“ Guardar Cambios]`

### **Cancelar ediciÃ³n sin guardar:**

1. Click en `[âœï¸ Editar]`
2. Hacer cambios
3. Click en `[Cancelar]`
4. Los cambios se descartan y vuelve a la vista normal

---

## ğŸ¯ Beneficios para el Usuario

âœ… **Flexibilidad Total** - Cambiar servicios sin salir del turno  
âœ… **Visual e Intuitivo** - Interfaz clara con iconos y colores  
âœ… **ValidaciÃ³n Inmediata** - Errores claros antes de guardar  
âœ… **CÃ¡lculos AutomÃ¡ticos** - DuraciÃ³n y precio en tiempo real  
âœ… **Sin Conflictos** - Valida disponibilidad automÃ¡ticamente  
âœ… **SincronizaciÃ³n** - Cambios reflejados al instante  

---

## ğŸ”’ Permisos y Seguridad

- âœ… Solo usuarios autenticados (`Bearer token`)
- âœ… Solo estados vÃ¡lidos: `PENDING`, `CONFIRMED`, `IN_PROGRESS`
- âœ… ValidaciÃ³n de `businessId` para multi-tenancy
- âœ… Servicios deben pertenecer al negocio
- âŒ No permite editar citas `COMPLETED` o `CANCELED`

---

## ğŸ“± Responsive Design

El modal se adapta a diferentes tamaÃ±os de pantalla:

- **Desktop:** Modal amplio con 2 columnas
- **Tablet:** Modal medio con 1.5 columnas
- **Mobile:** Modal completo (fullscreen) con scroll

---

## ğŸ¬ Demo en Video

**Secuencia tÃ­pica:**
1. â±ï¸ 0:00 - Abrir turno existente
2. â±ï¸ 0:03 - Click en "Editar" servicios
3. â±ï¸ 0:05 - Agregar nuevo servicio
4. â±ï¸ 0:08 - Ver resumen actualizado
5. â±ï¸ 0:10 - Guardar cambios
6. â±ï¸ 0:12 - ConfirmaciÃ³n exitosa
7. â±ï¸ 0:15 - Modal actualizado con nuevos servicios

**Tiempo total:** ~15 segundos âš¡

---

## ğŸ› Debugging

Si algo no funciona, revisar:

1. **Console del navegador** - Errores de red
2. **Network tab** - Request/Response del PUT
3. **Toast notifications** - Mensajes de error
4. **Server logs** - Validaciones en backend

---

## ğŸš€ PrÃ³ximas Mejoras

Posibles mejoras futuras:
- [ ] Drag & drop para reordenar servicios
- [ ] Aplicar descuento por servicio
- [ ] Sugerir servicios complementarios
- [ ] Historial de cambios en servicios
- [ ] Notificar al cliente por WhatsApp los cambios
