
> beauty-control-backend@1.0.0 test
> jest tests/integration/tenant-isolation.test.js

  console.log
    SIMPLE TEST LOG

      at Object.log (src/middleware/auth.js:402:11)

  console.log
    âœ… Servicio de email configurado correctamente

      at EmailService.log [as verifyConnection] (src/services/EmailService.js:33:15)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ¢ Branch Router - PeticiÃ³n recibida: {
      method: 'GET',
      path: '/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products',
      originalUrl: '/api/business/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products',
      hasAuthHeader: true
    }

      at log (src/routes/branches.js:8:11)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.warn
    No se pudo agregar branch stock sums: relation "branch_stocks" does not exist

    [0m [90m 92 |[39m         })[33m;[39m
     [90m 93 |[39m       } [36mcatch[39m (e) {
    [31m[1m>[22m[39m[90m 94 |[39m         console[33m.[39mwarn([32m'No se pudo agregar branch stock sums:'[39m[33m,[39m e[33m.[39mmessage [33m||[39m e)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 95 |[39m       }
     [90m 96 |[39m
     [90m 97 |[39m       res[33m.[39mjson({[0m

      at warn (src/controllers/productController.js:94:17)

::ffff:127.0.0.1 - - [24/Nov/2025:22:32:59 +0000] "GET /api/business/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products HTTP/1.1" 200 749 "-" "-"
  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ¢ Branch Router - PeticiÃ³n recibida: {
      method: 'GET',
      path: '/aadd93fd-b762-40bc-8fc9-791f09d40db0/products',
      originalUrl: '/api/business/aadd93fd-b762-40bc-8fc9-791f09d40db0/products',
      hasAuthHeader: true
    }

      at log (src/routes/branches.js:8:11)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: '480281fc-4f53-4a2c-870f-1ac8bcc0a698',
      businessId: 'aadd93fd-b762-40bc-8fc9-791f09d40db0'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'aadd93fd-b762-40bc-8fc9-791f09d40db0',
      name: 'Business B',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessB@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.warn
    No se pudo agregar branch stock sums: relation "branch_stocks" does not exist

    [0m [90m 92 |[39m         })[33m;[39m
     [90m 93 |[39m       } [36mcatch[39m (e) {
    [31m[1m>[22m[39m[90m 94 |[39m         console[33m.[39mwarn([32m'No se pudo agregar branch stock sums:'[39m[33m,[39m e[33m.[39mmessage [33m||[39m e)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 95 |[39m       }
     [90m 96 |[39m
     [90m 97 |[39m       res[33m.[39mjson({[0m

      at warn (src/controllers/productController.js:94:17)

::ffff:127.0.0.1 - - [24/Nov/2025:22:33:01 +0000] "GET /api/business/aadd93fd-b762-40bc-8fc9-791f09d40db0/products HTTP/1.1" 200 749 "-" "-"
  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ¢ Branch Router - PeticiÃ³n recibida: {
      method: 'GET',
      path: '/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products/31af79be-f324-4441-a67d-db442d37b2d9',
      originalUrl: '/api/business/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products/31af79be-f324-4441-a67d-db442d37b2d9',
      hasAuthHeader: true
    }

      at log (src/routes/branches.js:8:11)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

::ffff:127.0.0.1 - - [24/Nov/2025:22:33:03 +0000] "GET /api/business/fe24c445-0a56-4bd4-b830-12bc04ac3ddb/products/31af79be-f324-4441-a67d-db442d37b2d9 HTTP/1.1" 404 50 "-" "-"
  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ¢ Branch Router - PeticiÃ³n recibida: {
      method: 'GET',
      path: '/aadd93fd-b762-40bc-8fc9-791f09d40db0/products/31af79be-f324-4441-a67d-db442d37b2d9',
      originalUrl: '/api/business/aadd93fd-b762-40bc-8fc9-791f09d40db0/products/31af79be-f324-4441-a67d-db442d37b2d9',
      hasAuthHeader: true
    }

      at log (src/routes/branches.js:8:11)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

  console.log
    ğŸ” authenticateToken - Authorization header: Presente

      at log (src/middleware/auth.js:42:13)

  console.log
    ğŸ”‘ authenticateToken - Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...

      at log (src/middleware/auth.js:54:13)

  console.log
    âœ… authenticateToken: Token decoded successfully: {
      userId: 'd5966e82-02a9-4032-80de-42e00cb38f0c',
      businessId: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb'
    }

      at log (src/middleware/auth.js:58:13)

  console.log
    ğŸ¢ Auth Middleware - Branches cargadas: 0

      at log (src/middleware/auth.js:130:15)

  console.log
    ğŸ” Auth Middleware - Datos del usuario:

      at log (src/middleware/auth.js:133:13)

  console.log
      business: {
      id: 'fe24c445-0a56-4bd4-b830-12bc04ac3ddb',
      name: 'Business A',
      status: 'ACTIVE',
      trialEndDate: null,
      phone: null,
      email: 'businessA@test.com',
      address: null,
      city: null,
      state: null,
      country: null
    }

      at log (src/middleware/auth.js:134:13)

  console.log
      branches: Sin sucursales

      at log (src/middleware/auth.js:135:13)

::ffff:127.0.0.1 - - [24/Nov/2025:22:33:05 +0000] "GET /api/business/aadd93fd-b762-40bc-8fc9-791f09d40db0/products/31af79be-f324-4441-a67d-db442d37b2d9 HTTP/1.1" 404 50 "-" "-"
PASS tests/integration/tenant-isolation.test.js (24.028 s)
  Tenant Isolation Verification
    âˆš User A should see Product A (2840 ms)
    âˆš User B should see Product B (2433 ms)
    âˆš User A should NOT be able to access Product B via their own endpoint (2297 ms)
    âˆš User A should NOT be able to access Product B via Business B endpoint (2217 ms)

Test Suites: 1 passed, 1 total
Tests:       4 passed, 4 total
Snapshots:   0 total
Time:        24.177 s, estimated 44 s
Ran all test suites matching /tests\\integration\\tenant-isolation.test.js/i.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest with `--detectOpenHandles` to troubleshoot this issue.
